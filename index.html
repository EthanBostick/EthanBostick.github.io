<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethan | Portfolio</title>
    
    <link rel="stylesheet" href="styles/normalize.css">
    <link rel="stylesheet" href="styles/styles.css">

    <script src="https://cjrtnc.leaningtech.com/3.0/cj3loader.js"></script>
</head>
<body>

    <header class="site-header">
        <div class="container">
            <h1 class="logo">ethan@etonkabonk:~$</h1>
            <nav>
                <a href="#about">./about</a>
                <a href="#projects">./projects</a>
                <a href="#terminal">./play_zork</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section id="about" class="intro-grid">
            <div class="text-content">
                <h2>About Me</h2>
                <p>Hello. I'm a developer focusing on systems, data, and retro-gaming. Welcome to my digital workspace.</p>
                <a href="#terminal" class="btn primary">Run Game</a>
            </div>
            <div class="image-wrapper">
                <img src="images/selfie.JPG" alt="Ethan's Portrait" class="profile-pic">
            </div>
        </section>

        <section id="terminal" class="game-section">
            <h2>Interactive Terminal</h2>
            <div class="terminal-window">
                <div class="terminal-bar">
                    <div class="dots">
                        <span class="dot red"></span>
                        <span class="dot yellow"></span>
                        <span class="dot green"></span>
                    </div>
                    <span class="title">ethan@etonkabonk: ~/Work/Portfolio/textGame</span>
                </div>
                <div id="console-display" class="terminal-body">
                    <p class="loading-text">Initializing Java Virtual Machine...</p>
                </div>
            </div>
            <p class="caption">Type commands directly into the window above.</p>
        </section>
    </main>

    <footer class="site-footer">
        <p>&copy; 2026 Ethan. Built with &hearts; and Debian.</p>
    </footer>

	<script>
		(async function() {
			const consoleElement = document.getElementById('console-display');
			
			try {
				// 1. Calculate the Real URL (for debugging)
				// This handles both root domain and subfolders automatically
				let baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf("/") + 1);
				
				// If we are in the root, we need to append the textGame path
				// Adjust this if your index.html is not in the same root as textGame folder
				if (!baseUrl.includes("textGame")) {
					// If we are at root/, look in textGame/
					// If we are already in textGame/ (unlikely), don't add it.
				}
				
				// The paths CheerpJ uses
				// "rootPath" is just the path part of the URL (e.g., /Portfolio/)
				let rootPath = window.location.pathname;
				if (rootPath.endsWith("index.html")) {
					rootPath = rootPath.substring(0, rootPath.lastIndexOf("/") + 1);
				}
				if (!rootPath.endsWith("/")) {
					rootPath += "/";
				}

				// Define the paths
				const jarVirtualPath = "/app" + rootPath + "textGame/Zork.jar";
				const mapVirtualPath = "/app" + rootPath + "textGame/dungeon.zork";
				const realMapUrl = rootPath + "textGame/dungeon.zork";

				// 2. PRE-FLIGHT CHECK
				// We try to fetch the file via JS first to see if it exists.
				console.log("Testing if file exists at URL:", realMapUrl);
				const check = await fetch(realMapUrl);
				
				if (!check.ok) {
					throw new Error(`Browser cannot download file! \nUrl: ${realMapUrl} \nServer Status: ${check.status} (${check.statusText})`);
				} else {
					console.log("File found! Starting Java...");
				}

				// 3. Start Java
				await cheerpjInit();
				consoleElement.innerHTML = ""; // Clear loading text
				await cheerpjCreateDisplay(80, 25, consoleElement);
				
				// Run
				await cheerpjRunJar(jarVirtualPath, [mapVirtualPath]);

			} catch (e) {
				console.error(e);
				consoleElement.innerHTML = `<p style="color:red; font-family:monospace;">
					ERROR: ${e.message}<br><br>
					Check the F12 Console for details.
				</p>`;
			}
		})();
	</script>
</body>
</html>
